webpackJsonp([1],{"/5hJ":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o("7+uW"),i=o("8+8L"),r=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)};r._withStripped=!0;var a={render:r,staticRenderFns:[]},s=a;var l=!1;var c=o("VU/8")({name:"App"},s,!1,function(e){l||o("HnCy")},null,null);c.options.__file="src/_start/h5/App.vue";var d=c.exports,m=o("/ocq"),u={name:"index",data:function(){return{room:"",video:1,validate:!0}},computed:{isSafariOnIphone:function(){var e=window.navigator.userAgent;return-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version")&&-1!=e.indexOf("iPhone")}},methods:{joinRoom:function(){/^^[1-9]\d{5}$$/.test(this.room)?this.$router.push({name:"room",query:{room:this.room},params:{isSafariOnIphone:this.isSafariOnIphone}}):this.validate=!1},createRoom:function(){for(var e=void 0;!((e=Math.floor(1e6*Math.random()))>1e5););this.$router.push({name:"room",query:{room:e,video:this.video},params:{isSafariOnIphone:this.isSafariOnIphone}})}}},v=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"container"},[e._m(0),e._v(" "),o("div",{staticClass:"flex"},[o("div",[o("div",[o("h2",[e._v("加入一场会议")]),e._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:e.room,expression:"room"}],attrs:{type:"number",placeholder:"会议编号",required:""},domProps:{value:e.room},on:{input:function(t){t.target.composing||(e.room=t.target.value)}}}),e._v(" "),o("p",{class:e.validate?"":"error"},[e._v("会议编号是6位数字")]),e._v(" "),o("button",{on:{click:e.joinRoom}},[e._v("加入")])])]),e._v(" "),o("div",[o("div",[o("h2",[e._v("发起一场会议")]),e._v(" "),o("div",{staticClass:"radio"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.video,expression:"video"}],attrs:{type:"radio",id:"open",value:"1"},domProps:{checked:e._q(e.video,"1")},on:{change:function(t){e.video="1"}}}),e._v(" "),o("label",{attrs:{for:"open"}},[e._v("视频开启")])]),e._v(" "),o("div",{staticClass:"radio"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.video,expression:"video"}],attrs:{type:"radio",id:"close",value:"0"},domProps:{checked:e._q(e.video,"0")},on:{change:function(t){e.video="0"}}}),e._v(" "),o("label",{attrs:{for:"close"}},[e._v("视频关闭")])]),e._v(" "),o("button",{on:{click:e.createRoom}},[e._v("发起")])])])])])};v._withStripped=!0;var p={render:v,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"flex-center logo"},[t("img",{attrs:{src:"static/logo.png",alt:""}})])}]},f=p;var h=!1;var g=o("VU/8")(u,f,!1,function(e){h||o("EIJB")},"data-v-47323bf2",null);g.options.__file="src/components/index.vue";var _=g.exports,w=o("mvHQ"),S=o.n(w),b=o("2dwv");function C(){var e=window.navigator.userAgent,t=void 0!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),o=-1!=e.indexOf("Firefox"),n=void 0!=window.opr,i=e.indexOf("Chrome")&&window.chrome,r=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return t?"IE":o?"Firefox":n?"Opera":i?"Chrome":r?"Safari":"Unkown"}function y(){x.enumDevices(function(e){console.log("enumDevices",e),A=e},function(e){console.error("enum device error: "+e)})}b.appid;var x,P,V,O,k,M,A,R,I,N=b._config,E=b._otherConfig,$=!1,q=!1,F=[],U=[];function z(){console.info("leave room  and close stream"),q&&(x.stopPreview(P),x.stopPublishingStream(N.idName),q=!1);for(var e=0;e<F.length;e++)x.stopPlayingStream(F[e].stream_id);for(e=0;e<U.length;e++)x.stopPlayingStream(U[e].stream_id);F=[],U=[],x.logout()}function T(){(x=new ZegoClient).setUserStateUpdate(!0),console.log(N),x.config(N),y(),function(){var e={onStreamUpdated:function(e,t){if(console.log("onStreamUpdated",e,t),0==e){for(var o=F.length,n=U.length,i=0,r=0,a=0;a<t.length;a++)console.info(t[a].stream_id+" was added"),"v"===t[a].stream_id.charAt(0)?(F.push(t[a]),W(t[a].stream_id,O[o+i]),i++):(U.push(t[a]),B(t[a].stream_id,k[n+r]),r++);I(o+i)}else if(1==e){for(var s=!1,l=0;l<F.length;l++)for(var c=0;c<t.length;c++)if(F[l].stream_id===t[c].stream_id){x.stopPlayingStream(F[l].stream_id),console.info(F[l].stream_id+" was devared"),F.splice(l,1),s=!0;break}s&&j();var d=!1;for(l=0;l<U.length;l++)for(c=0;c<t.length;c++)if(U[l].stream_id===t[c].stream_id){x.stopPlayingStream(U[l].stream_id),console.info(U[l].stream_id+" was devared"),U.splice(l,1),d=!0;break}d&&Z()}}};for(var t in e)x[t]=e[t]}()}function j(){for(var e=F.length,t=0;t<e;t++)x.stopPlayingStream(F[t].stream_id);for(var o=0;o<e;o++)W(F[o].stream_id,O[o]);I(e)}function Z(){for(var e=U.length,t=0;t<e;t++)x.stopPlayingStream(U[t].stream_id);for(var o=0;o<e;o++)B(U[o].stream_id,k[o])}function D(e){var t={audio:!0,audioInput:A.microphones[0].deviceId||null,video:!0,facingMode:"user",videoQuality:2,horizontal:!0,externalCapture:!1,externalMediaStream:null};t=n.a.util.extend(t,e),console.log("previewConfig",t),x.startPreview(P,t,function(){console.log("preview success"),R(),q=!0,x.startPublishingStream(N.idName,P),y()},function(e){alert(S()(e)),console.error("preview failed",e)})||alert("预览失败！")}function J(e){var t={audio:!0,audioInput:A.microphones[0].deviceId||null,video:!1,videoInput:A.cameras[0].deviceId||null,videoQuality:2,horizontal:!0,externalCapture:!1,externalMediaStream:null};t=n.a.util.extend(t,e),console.log("previewConfig",t),(V=document.getElementById("screenAudio")).muted=!0,x.startPreview(V,t,function(){console.log("preview audio success"),x.startPublishingStream(N.idAudioName,V)},function(e){alert(S()(e)),console.error("preview failed",e)})||alert("预览失败！")}function W(e,t){var o=x.startPlayingStream(e,t);t.muted=!1,o||(alert("哎呀，播放失败啦"),t.style="display:none")}function B(e,t){var o=x.startPlayingStream(e,t,null,{playType:"audio"});t.muted=!1,o||(alert("哎呀，播放失败啦"),t.style="display:none")}var H=function(){for(var e=navigator.userAgent,t=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),o=!0,n=0;n<t.length;n++)if(e.indexOf(t[n])>0){o=!1;break}return o}()&&("Chrome"===C()||"Firefox"===C());console.log("sdk version is",ZegoClient.getCurrentVersion()),ZegoClient.isSupportWebrtc()?ZegoClient.isSupportH264(function(e){T(),e||alert("浏览器不支持视频h264编码，不能推拉音频流")},function(e){console.error(e)}):alert("浏览器不支持webrtc，换一个浏览器试试吧");var L={zg:x,openRoom:function(e,t,o,i,r,a,s){P=o,O=i,k=r,R=a,I=s,e?(M&&x.stopScreenShot(),n.a.http.get(E.token,{params:{app_id:N.appid,id_name:N.idName,cgi_token:E.cgi_token}}).then(function(o){console.log("gettoken success"),function(e,t,o){x.login(e,o,t,function(e){console.log("login success"),function(e,t){if(e.length>=20)return alert("房间太拥挤，换一个吧！"),void z();e.forEach(function(e){"v"===e.stream_id.charAt(0)?F.push(e):U.push(e)}),j(),Z(),console.log("login success"),$=!0,1===t&&D()}(e,o)},function(e){!function(e){alert("登录失败"),console.error(e)}(e)})}(e,o.data,t)})):alert("请输入房间号")},enableCamera:function(e){x.enableCamera(P,e)},enableMicrophone:function(e){x.enableMicrophone(P,e)},isSupportShareScreen:H,enableScreen:function(e){e?($&&x.stopPublishingStream(N.idName),$&&x.stopPreview(P),"Firefox"===C()&&x.startScreenShotFirFox("window",!1,function(e,t){console.log("startScreenShot:"+e),M=e,P.srcObject=t,$&&(D({externalMediaStream:null,width:640,height:480,frameRate:15,bitRate:1e3}),J({audio:!1}))}),"Chrome"===C()&&x.startScreenShotChrome(function(e,t){console.log("startScreenShot:"+e),M=e,P.srcObject=t,$&&(D({externalCapture:!0,audio:!1}),J())})):(x.stopScreenShot(),x.stopPreview(P),x.stopPublishingStream(N.idName),D(),x.stopPreview(V),x.stopPublishingStream(N.idAudioName))},leaveRoom:z},G={name:"room",data:function(){return{previewVideo:!1,remoteVideo:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],lengthOfRemoteVideo:0,enableCamera:!0,enableMic:!0,enableScreen:!1}},beforeCreate:function(){this.$route.params.isSafariOnIphone&&location.reload(!0)},mounted:function(){var e=this;L.openRoom(this.room,1,document.getElementById("previewVideo"),document.querySelectorAll(".remoteVideo"),document.querySelectorAll(".remoteAudio"),function(){e.previewVideo=!0,"0"===e.$route.query.video&&e.toggleCamera()},function(t){e.lengthOfRemoteVideo=t;for(var o=0;o<e.remoteVideo.length;o++)e.remoteVideo.splice(o,1,o<t)})},computed:{room:function(){return this.$route.query.room+""},isSupportShareScreen:function(){return L.isSupportShareScreen}},methods:{toggleCamera:function(){this.enableCamera=!this.enableCamera,L.enableCamera(this.enableCamera)},toggleMic:function(){this.enableMic=!this.enableMic,L.enableMicrophone(this.enableMic)},toggleScreen:function(){this.enableScreen=!this.enableScreen,L.enableScreen(this.enableScreen)},copyToClipboard:function(){var e="您好，快来加入视频会议吧，我在这儿等你："+location.origin+"#/room?room="+this.room,t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),alert("会议的链接已经复制到剪贴板，请通过邮件，微信等发送给他人即可加入该会议。")},endMeeting:function(){L.leaveRoom(),this.$router.push({name:"index"})}}},Q=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"container flex"},[o("div",{staticClass:"room",class:e.lengthOfRemoteVideo<=3?"":"scroll"},[o("div",{staticClass:"video flex-center",class:e.previewVideo?"":"opacity55"},[o("video",{directives:[{name:"show",rawName:"v-show",value:e.previewVideo,expression:"previewVideo"}],attrs:{id:"previewVideo",muted:"",autoplay:"",playsinline:"",controls:""},domProps:{muted:!0}}),e._v(" "),o("img",{directives:[{name:"show",rawName:"v-show",value:!e.previewVideo,expression:"!previewVideo"}],attrs:{src:"static/roomset_1.png",alt:""}})]),e._v(" "),e._l(e.remoteVideo,function(t,n){return o("div",{directives:[{name:"show",rawName:"v-show",value:e.lengthOfRemoteVideo<=3?n<3:n<e.lengthOfRemoteVideo,expression:"lengthOfRemoteVideo<=3? i<3: i<lengthOfRemoteVideo"}],staticClass:"video flex-center",class:t?"":"opacity55"},[o("video",{directives:[{name:"show",rawName:"v-show",value:t,expression:"r"}],staticClass:"remoteVideo",attrs:{autoplay:"",playsinline:"",controls:""}}),e._v(" "),o("img",{directives:[{name:"show",rawName:"v-show",value:!t,expression:"!r"}],attrs:{src:"static/roomset_"+(n+2)+".png",alt:""}})])})],2),e._v(" "),o("div",{staticClass:"bottom"},[o("div",[o("div",{on:{click:e.toggleCamera}},[o("img",{attrs:{src:"static/camera.png",alt:""}}),e._v(" "),o("div",{staticClass:"circle"},[o("i",{class:e.enableCamera?"green":"red"}),e._v("\n          "+e._s(e.enableCamera?"关闭视频":"开启视频")+"\n        ")])]),e._v(" "),o("div",{on:{click:e.toggleMic}},[o("img",{attrs:{src:"static/mic.png",alt:""}}),e._v(" "),o("div",{staticClass:"circle"},[o("i",{class:e.enableMic?"green":"red"}),e._v("\n          "+e._s(e.enableMic?"关闭声音":"开启声音")+"\n        ")])]),e._v(" "),e.isSupportShareScreen?o("div",{on:{click:e.toggleScreen}},[o("img",{attrs:{src:"static/screen"+(e.enableScreen?"-dis":"")+".png",alt:""}}),e._v("\n        "+e._s(e.enableScreen?"关闭分享":"屏幕分享")+"\n      ")]):e._e()]),e._v(" "),o("div",[o("div",{on:{click:e.copyToClipboard}},[o("img",{attrs:{src:"static/link.png",alt:""}}),e._v("\n        复制链接\n      ")]),e._v(" "),e._m(0),e._v(" "),o("div",{staticClass:"red",on:{click:function(t){e.endMeeting()}}},[o("img",{attrs:{src:"static/end-meeting.png",alt:""}}),e._v("\n        结束会议\n      ")]),e._v(" "),o("div",[o("span",{staticClass:"flex-center"},[e._v(e._s(e.room))]),e._v("\n        会议编号\n      ")])]),e._v(" "),o("div",{staticClass:"none"},[o("audio",{attrs:{id:"screenAudio",autoplay:"",muted:"",playsinline:""}}),e._v(" "),e._l(e.remoteVideo,function(e){return o("audio",{staticClass:"remoteAudio",attrs:{autoplay:"",playsinline:""}})})],2)])])};Q._withStripped=!0;var X={render:Q,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("img",{attrs:{src:"static/invite.png",alt:""}}),this._v("\n        邀请朋友\n      ")])}]},K=X;var Y=!1;var ee=o("VU/8")(G,K,!1,function(e){Y||o("vZf/")},"data-v-7030392a",null);ee.options.__file="src/components/room.vue";var te=ee.exports,oe=function(){var e=this.$createElement;this._self._c;return this._m(0)};oe._withStripped=!0;var ne={render:oe,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"template-view"},[t("button",{staticClass:".btn"},[this._v("Get Method")])])}]},ie=ne;var re=!1;var ae=o("VU/8")({name:"template",components:{},data:function(){return{show:!1}},methods:{}},ie,!1,function(e){re||o("p+W8")},"data-v-2f56c616",null);ae.options.__file="src/pages/test.vue";var se=ae.exports;n.a.use(m.a);var le=new m.a({routes:[{path:"/",name:"index",component:_},{path:"/room",name:"room",component:te},{path:"/test",name:"test",component:se}]});o("MGcz");n.a.config.productionTip=!1,n.a.use(i.a),new n.a({el:"#app",router:le,components:{App:d},template:"<App/>"})},0:function(e,t){},"2dwv":function(e,t,o){"use strict";e.exports={appid:3104114736,_config:{appid:3104114736,idName:"v"+(new Date).getTime(),idAudioName:"a"+(new Date).getTime(),nickName:"u"+(new Date).getTime(),server:"wss://wsliveroom3104114736-api.zego.im:8282/ws",logLevel:2,logUrl:"",remoteLogLevel:0,audienceCreateRoom:!0},_otherConfig:{cgi_token:"",roomlist:"",signal:"",token:"https://wsliveroom-demo.zego.im:8282/token"}}},EIJB:function(e,t){},HnCy:function(e,t){},MGcz:function(e,t){},"p+W8":function(e,t){},"vZf/":function(e,t){}},["/5hJ"]);
//# sourceMappingURL=app.8b2c7cde7dade751223e.js.map