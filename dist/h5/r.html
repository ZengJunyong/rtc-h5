<!DOCTYPE html>
<html>
<head>
    <title>WEBRTC Demo</title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta http-equiv="Content-Security-Policy" content="default-src *; media-src *;style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'">
</head>
<body>
<!-- 音视频 -->
<!--
    本地视频流
    muted:
        本地视频流的video必须置为静音（muted)，否则会出现啸叫/回声等问题
        Mac / iPhone / iPad 需要用js设置muted属性
    autoplay：必须为激活状态
    playsinline：保证在ios safari中不全屏播放
 -->
<video id="localVideo" muted autoplay playsinline></video>
<!-- 远端视频流 -->
<video id="remoteVideo" autoplay playsinline></video>


<!-- 纯音频 -->
<!-- 本地音频流 / 这种场景下，localaudio 其实没有播放的必要了，可以用来调试 -->
<!-- <audio id="localAudioMedia"  muted autoplay></audio> -->
<!-- 远端音频流 -->
<!-- <audio id="remoteAudioMedia" autoplay ></audio> -->
<script src="https://sqimg.qq.com/expert_qq/webrtc/3.0/WebRTCAPI.min.js"></script>
<script>
    window.configData = {
        "sdkappid": 1400176759,
        "users": [{
            "userId": "Web_trtc_01",
            "userToken": "eJxlj1FPgzAYRd-5FYTXGdOylolvyIagbG5iZPOlYVDwk6zUrmxM43834hJJvK-n5N7cT8M0TespTi6zPG9aoZk*SW6Z16aFrIs-KCUULNNsrIp-kHcSFGdZqbnqIaaU2ggNHSi40FDC2Uj5lmmlc4bwQNoXNeuXflsIQnjiTKg7VKDq4Xy28aOV75RtHHR1E*r7UUUjiiNHCO8u3B385*pDhsvHiuKXcD5KvejVW9JFAnEaJ6RbHetbMaM37cO6Csibv11s7GkwBVlD*r4*xYNJDTt*vkUc4rpXNhnQA1d7aEQv2AhTbI-RTyzjy-gGYDJeuA__"
        }, {
            "userId": "Web_trtc_02",
            "userToken": "eJxlj0FPgzAAhe-8CtKrRltoh5h4QIRlOiLqFiaXptJOmwmUUmDT*N*NuEQS3-X78l7ep2XbNlgtn85YUdRdZag5KAHsSxtAcPoHlZKcMkNdzf9BsVdSC8q2RugRIkKIA*HUkVxURm7l0cjECzXaFBQ6E6nlOzou-bZgCJE384g-VeTrCJNoHS6C-C5vyH36OOd*E4QkWPbxgE3*lm64yhJ57g5pWuH69rAPZBSorkHPmJ2UzMNhuR4KMo*yOHqv*48bzzywVbtxrxfdLomHq8mkkaU43sIz7PsXDp7QXuhW1tUoOBAR5LjwJ8D6sr4BpGtfSw__"
        }, {
            "userId": "Web_trtc_03",
            "userToken": "eJxlj11PgzAARd-5FQ2vGm0LZeKbInOLjGyDbdGXhtEWO*SrdERm-O9GtkQS7*s5uTf3ywAAmHEQ3SRpWh1LTXVfcxPcAxOa13*wriWjiaaWYv8g-6yl4jQRmqsBIkIIhnDsSMZLLYW8GDu*p1rplEJrJLUsp8PSucWGEE2cCXHHiswGuPBfvfnK*1grpz-kFYq8vfN4O5NTN9QFT-v2uVnEUR6ug3D35s9O8Wr*-rCsX4pjh7otlMtsI4orV4nGOmQC21v01E9PUdv52A8Ya0aTWhb8cst2bNe9w-aIdly1sioHAUNEELbgb0zj2-gBBghgCA__"
        }, {
            "userId": "Web_trtc_04",
            "userToken": "eJxlj11vgjAYhe-5FQ3Xy2wLRfCOVOcgcxtDZ7xqkBZoVGS1yMey-76MmYxk7*3z5JzzfhoAAHP9FN8naXquS810VwkTzIAJzbs-WFWSs0QzS-F-ULSVVIIlmRZqgIgQgiEcO5KLUstM3oyt2DOtdMqgPZIu-MCGpt8UG0I0dabEGysyH*BqsaNBRPMden5MaBG6HXHft83hWuNsEeSvvuDLltMJbnBBj3vrGAWFvyroMrTyh9pOP3rY9RPcIhWvN84Llac3GIq8SeKyj*b*fFSp5Unc3rId2-NcPN58Feoiz*UgYIgIwhb8OdP4Mr4Bj1JfEg__"
        }],
        "roles": [{"name": "ed640", "value": "640x480"}, {"name": "ed1280", "value": "1280x720"}, {
            "name": "ed960",
            "value": "960x540"
        }, {"name": "ed480", "value": "480x320"}, {"name": "ed320", "value": "320x240"}]
    }
    var index = Math.floor(Math.random() * 4)
    console.log("user_id",index)
    var RTC = new WebRTCAPI({
        "userId": configData.users[index].userId,
        "userSig": configData.users[index].userToken,
        "sdkAppId": configData.sdkappid
    });

    //本地流 新增
    RTC.on("onLocalStreamAdd", function(data){
        console.log('onLocalStreamAdd')
        if( data && data.stream){
            document.querySelector("#localVideo").srcObject = data.stream;
        }
    });
    //远端流 新增/更新
    RTC.on("onRemoteStreamUpdate", function(data){
        console.log('onRemoteStreamUpdate')
        if( data && data.stream){
            document.querySelector("#remoteVideo").srcObject = data.stream;
        }
    });
    RTC.getLocalStream({
        video: true,
        audio: true,
        attributes: {
            width: 640,
            height: 480,
            frameRate: 20
        }
    }, function (info) {
        // info { stream }
        var stream = info.stream;

        //初始化完成后调用进房接口
        RTC.enterRoom({
            roomid : 456789
        },function(){
            //进房成功，音视频推流
            RTC.startRTC({
                role : "ed640",   //画面设定的配置集名 （见控制台 - 画面设定 )
                stream: stream
            },function(){
console.log("success")

            },function(err){

                console.log(err)
            });
        },function(){

        });
    }, function (error) {
        console.error(error)
    });

RTC.onErrorNotify(function(error){
    console.log("error", error);
})
console.log(RTC)
</script>
</body>
</html>
